// Generated by CoffeeScript 1.7.1
(function() {
  window.Drone = function(config) {
    var d, _$div;
    _$div = function(className) {
      return $('<div>').attr('class', className);
    };
    d = {
      id: config.id || config.ip.split(".").pop(),
      ip: config.ip,
      takeOff: function() {},
      land: function() {},
      stop: function() {},
      move: function() {},
      animate: function() {},
      navdata: function() {},
      updateNavdata: function(navdata) {
        d.navdata = navdata;
        d.updateBattery(navdata.demo.batteryPercentage);
        return ["clockwiseDegrees", "altitudeMeters", "frontBackDegrees", "leftRightDegrees", "xVelocity", "yVelocity", "zVelocity"].forEach(function(param) {
          return d._$wrapper.find(".navdata-" + param).html(Math.round(navdata.demo[param], 4));
        });
      },
      updateBattery: function(percentage) {
        d._$batteryBar.width(percentage + "%").text(percentage + "%");
        if (percentage < 30 && percentage >= 20) {
          return d._$batteryProgress.removeClass('progress-success').addClass('progress-warning').removeClass('progress-danger');
        } else if (percentage < 20) {
          return d._$batteryProgress.removeClass('progress-success').removeClass('progress-warning').addClass('progress-danger');
        } else {
          return d._$batteryProgress.addClass('progress-success').removeClass('progress-warning').removeClass('progress-danger');
        }
      },
      control: config.control || false,
      toggle: function() {
        return d.enable(!d.control);
      },
      enable: function(status, quiet) {
        d.control = status;
        if (status) {
          d._$wrapper.addClass('control');
          d._$ip.addClass('badge-success');
        } else {
          d._$wrapper.removeClass('control');
          d._$ip.removeClass('badge-success');
        }
        if (!quiet) {
          return socket.publish("/drone/enable", {
            id: d.id,
            status: d.control
          });
        }
      },
      terminate: function() {
        return clearInterval(d._cameraTimer);
      },
      _$ip: _$div('ip badge'),
      _$cameraImg: $('<img>'),
      _$batteryProgress: _$div('battery progress'),
      _$batteryBar: _$div('bar').css('width', '100%'),
      _$wrapper: _$div('drone'),
      _template: function() {
        var $battery, $camera, $ip, $navdata;
        $ip = d._$ip.appendTo(d._$wrapper).text(d.ip);
        $camera = _$div('camera').appendTo(d._$wrapper);
        $camera.append(d._$cameraImg);
        $navdata = _$div('navdata').appendTo(d._$wrapper);
        $battery = d._$batteryProgress.appendTo($navdata).append(d._$batteryBar);
        $navdata.append('<div>clockwiseDegrees: <span class="navdata-clockwiseDegrees"></span></div>').append('<div>altitudeMeters: <span class="navdata-altitudeMeters"></span></div>').append('<div>frontBackDegrees: <span class="navdata-frontBackDegrees"></span></div>').append('<div>leftRightDegrees: <span class="navdata-leftRightDegrees"></span></div>').append('<div>xVelocity: <span class="navdata-xVelocity"></span></div>').append('<div>yVelocity: <span class="navdata-yVelocity"></span></div>').append('<div>zVelocity: <span class="navdata-zVelocity"></span></div>');
        return d._$wrapper;
      }
    };
    $('#drones').append(d._template);
    d.enable(config.enabled, true);
    d._$cameraImg.click(function(e) {
      e.stopPropagation();
      e.preventDefault();
      socket.publish("/drone/camera", {
        id: d.id,
        camera: "toggle"
      });
      return false;
    });
    d._$wrapper.click(function() {
      return d.toggle();
    });
    d._$wrapper.dblclick(function(e) {
      return swarm.forEach(function(drone) {
        return drone.enable(drone.id === d.id);
      });
    });
    d._cameraTimer = setInterval(function() {
      return d._$cameraImg.attr({
        src: "/drone/camera/" + d.id + "/" + (Math.random())
      });
    }, 100);
    socket.subscribe("/drone/navdata/" + d.id, function(navdata) {
      return d.updateNavdata(navdata);
    });
    return d;
  };

}).call(this);
